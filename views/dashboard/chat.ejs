<div class="wrapper">
    <div id="chatBoxDiv" class="container">
        <div id="output"></div>
        <form class="input-group" id="chatForm">
            <input
                    class="col-10"
                    type="text"
                    autocomplete="off"
                    placeholder="message"
                    required
                    id="chatInput"
                    maxlength="200"
            />
            <input
                    class="btn-primary col-2"
                    type="submit"
                    id="chatSubmit"
                    value="Send"
            />
        </form>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="modal-body">
                    <!-- <iframe width="560" height="315" src="https://www.youtube.com/embed/dQw4w9WgXcQ?controls=0?autoplay=1" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe> -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.plyr.io/3.5.6/plyr.js"></script>
<link rel="stylesheet" href="https://cdn.plyr.io/3.5.6/plyr.css" />
    <!-- <div id="player" data-plyr-provider="youtube" data-plyr-embed-id="dQw4w9WgXcQ"></div> -->
    <div id="player" data-plyr-provider="vimeo" data-plyr-embed-id="148751763"></div>
<script>
    socket = io();
    const player = new Plyr('#player',{
        clickToPlay:false,
        listeners: {
        seek: function (e) {
            e.preventDefault();
            return false;
        },
        play: function (e) {
            e.preventDefault();
            return false;
        }
    },
    keyboard: {
        focused:false,
        global:false
    },
    controls : ['play', 'progress', 'current-time', 'mute', 'volume', 'captions', 'pip', 'fullscreen']
    });

$('.plyr').click(function(e){
    if(e.target == ($('.plyr__controls__item')[0])){
        playSocket();
    }

    if(e.target === $('input[data-plyr ="seek"]')[0]){
    let percent = ($('input[data-plyr ="seek"]').attr('seek-value')/100);
    let videoLength = ($('input[data-plyr ="seek"]').attr('aria-valuemax'));
    seekSocket(percent*videoLength);
    }
});

$('.plyr').keydown(function(e){
    if(e.key === 'k' || e.key === 'K' || e.key === 'Space'){
        playSocket();
    }else if(e.key === 'ArrowRight'){
        seekKeySocket(10);
    }else if(e.key === 'ArrowLeft'){
        seekKeySocket(-10);
    }
});

function playSocket(){
    if(player.playing === false){
            playing = true;
        }else{
            playing = false;
        }
        socket.emit('player',{
            playing:playing,
            position : player.currentTime
        });
}
function seekKeySocket(offset){
    if(player.playing === false){
            playing = false;
        }else{
            playing = true;
        }
        socket.emit('player',{
            playing:playing,
            position : player.currentTime + offset
        });
}
function seekSocket(time){
    if(player.playing === false){
            playing = false;
        }else{
            playing = true;
        }
        socket.emit('player',{
            playing:playing,
            position : time
        });
}
    socket.on('playing',function(data){
        if(data.playing === true && player.playing === false){
            player.play();
        }else if(data.playing === false && player.playing === true){
            player.pause();
        }
        if(player.currentTime !== data.position && !player.seeking){
                player.currentTime = data.position;
        }
    });
</script>